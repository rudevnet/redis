# Начало работы с Redis

Как приступить к работе с Redis

---

Это руководство по началу работы с Redis. Вы узнаете, как устанавливать, запускать и экспериментировать с серверным процессом Redis.

## Установка Redis

Способ установки Redis зависит от вашей операционной системы и от того, хотите ли вы установить его в комплекте с Redis Stack и Redis UI. Смотрите руководство ниже, которое лучше всего соответствует вашим потребностям:

* [Установка Redis из исходного кода](installation/install-redis-from-source.md)
* [Установка Redis в Linux](installation/install-redis-on-linux.md)
* [Установка Redis в macOS](installation/install-redis-on-mac-os.md)
* [Установка Redis в Windows](installation/install-redis-on-windows.md)
* [Установка Redis вместе с Redis Stack и RedisInsight](../stack/get-started/install)

После того, как вы запустите Redis и сможете подключиться с помощью `redis-cli`, вы можете продолжить выполнение следующих шагов.

## Изучите Redis с помощью CLI

Внешние программы взаимодействуют с Redis, используя сокет TCP и специальный протокол Redis. Этот протокол реализован в клиентских библиотеках Redis для разных языков программирования. Однако, чтобы упростить работу, Redis предоставляет утилиту командной строки, которую можно использовать для отправки команд в Redis. Эта программа называется **redis-cli**.

Первое, что нужно сделать, чтобы проверить, правильно ли работает Redis, — отправить команду **PING** с помощью redis-cli:

    $ redis-cli ping
    PONG

Запуск **redis-cli**, за которым следует имя команды и ее аргументы, отправит эту команду экземпляру Redis, работающему на локальном хосте с портом 6379. Вы можете изменить хост и порт, используемые `redis-cli` - просто попробуйте параметр `--help`, чтобы увидеть информацию об использовании.

Еще один интересный способ запустить `redis-cli` без аргументов: программа запустится в интерактивном режиме. Вы можете вводить различные команды и видеть их ответы.

    $ redis-cli
    redis 127.0.0.1:6379> ping
    PONG
    redis 127.0.0.1:6379> set mykey somevalue
    OK
    redis 127.0.0.1:6379> get mykey
    "somevalue"

На этом этапе вы можете поговорить с Redis. Настало время немного приостановиться в этом руководстве и начать [пятнадцатиминутное введение в типы данных Redis](data-types/tutorial.md), чтобы изучить несколько команд Redis. В противном случае, если вы уже знаете несколько основных команд Redis, вы можете продолжить чтение.

## Защита Redis


По умолчанию Redis привязывается ко **всем интерфейсам** и вообще не использует аутентификацию.
Если вы используете Redis в очень контролируемой среде, отделенной от
внешнего Интернета и вообще от злоумышленников, это поведение нормально. Однако, если незащищенный Redis
подвергается воздействию Интернета, это является серьезной проблемой безопасности. Если вы не уверены на 100%, что ваша среда защищена должным образом, проверьте следующие шаги, чтобы сделать Redis более безопасным, которые перечислены в порядке повышения безопасности.

1. Убедитесь, что порт, который Redis использует для прослушивания подключений (по умолчанию 6379 и дополнительно 16379, если вы запускаете Redis в кластерном режиме, плюс 26379 для Sentinel), защищен брандмауэром, чтобы невозможно было связаться с Redis из внешнего мира.
2. Используйте файл конфигурации, в котором установлена директива `bind`, чтобы гарантировать, что Redis прослушивает только те сетевые интерфейсы, которые вы используете. Например, только петлевой интерфейс (127.0.0.1), если вы получаете доступ к Redis только локально с того же компьютера и так далее.
3. Используйте параметр `requirepass`, для того чтобы добавить дополнительный уровень безопасности и чтобы клиенты запрашивали аутентификацию с помощью команды `AUTH`.
4. Используйте [spiped](http://www.tarsnap.com/spiped.html) или другое программное обеспечение для туннелирования SSL, чтобы зашифровать трафик между серверами Redis и клиентами Redis, если ваша среда требует шифрования.

Обратите внимание, что экземпляр Redis, доступный в Интернет без какой-либо защиты, [очень легко взломать](http://antirez.com/news/96), поэтому убедитесь, что вы понимаете вышеизложенное и примените **хотя бы** уровень брандмауэра. После настройки брандмауэра попробуйте подключиться с помощью `redis-cli` с внешнего хоста, чтобы убедиться, что экземпляр на самом деле недоступен.

## Используйте Redis из своего приложения

Конечно, использовать Redis только из интерфейса командной строки недостаточно,
поскольку цель состоит в том, чтобы использовать его из вашего приложения. Для этого вам необходимо
загрузить и установить клиентскую библиотеку Redis для вашего языка программирования.
На этой странице вы найдете [полный список клиентов для разных языков](https://redis.io/clients).

Например, если вы используете язык программирования Ruby, наш лучший совет
— использовать клиент [Redis-rb](https://github.com/redis/redis-rb).
Вы можете установить его с помощью команды **gem install redis**.

Эти инструкции специфичны для Ruby, но на самом деле многие клиентские библиотеки
для популярных языков выглядят очень похоже: вы создаете объект Redis и выполняете
команды, вызывающие методы. Короткий интерактивный пример с использованием Ruby:

    >> require 'rubygems'
    => false
    >> require 'redis'
    => true
    >> r = Redis.new
    => #<Redis client v4.5.1 for redis://127.0.0.1:6379/0>
    >> r.ping
    => "PONG"
    >> r.set('foo','bar')
    => "OK"
    >> r.get('foo')
    => "bar"

## Сохраняемость в Redis

Вы можете узнать, [как работает сохраняемость Redis, на этой странице](https://redis.io/topics/persistence), однако для быстрого старта важно понять, что по умолчанию, если вы запускаете Redis с конфигурацией по умолчанию, Redis самопроизвольно сохраняет набор данных только время от времени (например, после по крайней мере пяти минут, если у вас есть как минимум 100 изменений в ваших данных), поэтому, если вы хотите, чтобы ваша база данных сохранялась и перезагружалась после перезапуска, обязательно вызывайте команду **SAVE** вручную каждый раз, когда вы хотите принудительно сделать снимок набора данных. В противном случае обязательно отключите базу данных с помощью команды **SHUTDOWN**:

    $ redis-cli shutdown

Таким образом, Redis обязательно сохранит данные на диск перед выходом.
Настоятельно рекомендуется прочитать [страницу про сохраняемость](https://redis.io/topics/persistence), чтобы лучше понять, как работает сохраняемость в Redis.

## Установите Redis более правильно

Запуск Redis из командной строки удобен только для простых вещей или для разработки. Однако в какой-то момент у вас появится реальное приложение для запуска на реальном сервере. Для такого использования у вас есть два разных варианта:

* Запустите Redis, используя screen.
* Установите Redis на свою Linux машину надлежащим образом, используя сценарий(скрипт) инициализации, чтобы после перезагрузки все снова запустилось правильно.

Настоятельно рекомендуется правильная установка с использованием сценария инициализации.
Следующие инструкции можно использовать для выполнения правильной установки с использованием сценария инициализации, поставляемого с Redis версии 2.4 или выше в дистрибутивах на основе Debian или Ubuntu.

Мы предполагаем, что вы уже скопировали исполняемые файлы **redis-server** и **redis-cli** в /usr/local/bin.

* Создайте каталог, в котором будут храниться файлы конфигурации Redis и ваши данные:

        sudo mkdir /etc/redis
        sudo mkdir /var/redis

* Скопируйте сценарий инициализации, который вы найдете в дистрибутиве Redis в каталоге **utils** в `/etc/init.d`. Мы предлагаем называть его именем порта, на котором вы запускаете этот экземпляр Redis. Например:

        sudo cp utils/redis_init_script /etc/init.d/redis_6379

* Отредактируйте сценарий инициализации.

        sudo vi /etc/init.d/redis_6379

Обязательно измените **REDISPORT** в соответствии с используемым портом.
И путь к файлу pid, и имя файла конфигурации зависят от номера порта.

* Скопируйте шаблон файла конфигурации, который вы найдете в корневом каталоге дистрибутива Redis, в `/etc/redis/`, используя номер порта в качестве имени, например:

        sudo cp redis.conf /etc/redis/6379.conf

* Создайте каталог внутри `/var/redis`, который будет работать как каталог данных и рабочий каталог для этого экземпляра Redis:

        sudo mkdir /var/redis/6379

* Отредактируйте файл конфигурации, обязательно внося следующие изменения:
    * Установите для параметра **daemonize** значение yes (по умолчанию установлено значение no).
    * Установите для **pidfile** значение `/var/run/redis_6379.pid` (при необходимости измените порт).
    * Соответственно измените **port**. В нашем примере это не нужно, так как порт по умолчанию уже 6379.
    * Установите предпочитаемый уровень для **loglevel**.
    * Установите для **logfile** значение `/var/log/redis_6379.log`
    * Установите для **dir** значение `/var/redis/6379` (очень важный шаг!)

* Наконец, добавьте новый сценарий инициализации Redis на все уровни запуска по умолчанию, используя следующую команду:

        sudo update-rc.d redis_6379 defaults

Вы это сделали! Теперь вы можете попробовать запустить свой экземпляр с помощью:

    sudo /etc/init.d/redis_6379 start

Убедитесь, что все работает как положено:

* Попробуйте пропинговать свой экземпляр с помощью redis-cli.
* Выполните тестовое сохранение с помощью `redis-cli save` и убедитесь, что файл дампа правильно сохранен в `/var/redis/6379/` (вы должны найти файл с именем `dump.rdb`).
* Убедитесь, что ваш экземпляр Redis правильно регистрируется в файле журнала.
* Если это новая машина, где вы можете испытывать её без проблем, убедитесь, что после перезагрузки все остаётся в рабочем состоянии.

Примечание: Приведенные выше инструкции не включают все параметры конфигурации Redis, которые вы можете изменить, например, для использования сохраняемости AOF вместо сохраняемости RDB, для настройки репликации и т.д.
Обязательно прочитайте пример файла [`redis.conf`](https://github.com/redis/redis/blob/6.2/redis.conf) (он имеет много комментариев).
